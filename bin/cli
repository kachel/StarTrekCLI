#!/usr/bin/env ruby

require 'bundler/setup'
require 'StarTrekCLI'
require 'optparse'
require 'rb-readline'

# stateless interface
instructions = {}

parser = OptionParser.new do |opts|
  opts.banner = "Usage: example.rb [instructions]"

  opts.on("-v", "--[no-]verbose", "Run verbosely") do |v|
    instructions[:verbose] = v
  end

  opts.on("--list-series", "List series") do |bool|
    # either true or false hence the |bool|
    instructions[:list_series] = bool
  end

  opts.on("--list-seasons SERIES", "List seasons for a series") do |series|
  # list seasons *for* this series
    instructions[:list_seasons] = series
  end

  # list episodes for a season
  opts.on("--list-episodes SERIES:SEASON", "List episodes for a season") do |spec|
    raise "COMPUTER: Do not forget your colon. You typed '#{spec}'" unless spec.include?(":")
    instructions[:list_episodes] = spec.split(":")
  end

  opts.on("--list-episode-info SERIES:SEASON:PRODUCTION", "List episodes information") do |spec|
    raise "COMPUTER: Do not forget *both* of your colons. You typed '#{spec}'" unless spec.include?(":")
    instructions[:list_episode_info] = spec.split(":")
  end

end # parser

parser.parse!

controller = StarTrekCLI::Controller.new(instructions[:verbose])

if instructions[:list_series]
  puts "All Star Trek series:"
  controller.list_series

elsif instructions[:list_seasons]
  puts "Here are the seasons for #{instructions[:list_seasons]}:"
  controller.list_seasons(instructions[:list_seasons])

elsif instructions[:list_episodes]
  puts "Here are the episodes:"
  controller.list_episodes(instructions[:list_episodes][0], instructions[:list_episodes][1])

elsif instructions[:list_episode_info]
 puts "Here is the episode information:"
 a, b, c = instructions[:list_episode_info]
 controller.list_episode_info(a, b, c)

else
  puts "TODO print"
end



# TODO: print help if no arguments
